name: Nightly Agent Evaluation

on:
  schedule:
    # Run every day at 08:00 UTC (3:00 AM EST)
    - cron: '0 8 * * *'
  workflow_dispatch:

jobs:
  evaluate:
    name: Run ADK Evaluations
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v6

    - name: Authenticate to Google Cloud
      uses: google-github-actions/auth@v3
      with:
        credentials_json: '${{ secrets.GCP_SA_KEY }}'

    - name: Install uv
      uses: astral-sh/setup-uv@v7
      with:
        enable-cache: true

    - name: Set up Python 3.10
      run: uv python install 3.10

    - name: Install dependencies
      run: uv sync

    - name: Run Evaluations
      env:
        GOOGLE_CLOUD_PROJECT: ${{ secrets.GOOGLE_CLOUD_PROJECT }}
        GOOGLE_CLOUD_LOCATION: ${{ secrets.GOOGLE_CLOUD_LOCATION }}
        GOOGLE_CLOUD_STORAGE_BUCKET: ${{ secrets.GOOGLE_CLOUD_STORAGE_BUCKET }}
        # Default to Vertex AI for evals
        GOOGLE_GENAI_USE_VERTEXAI: "1"
      run: |
        touch .env
        uv run poe eval
